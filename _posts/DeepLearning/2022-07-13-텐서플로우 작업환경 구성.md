---
title: "í…ì„œí”Œë¡œìš° ì‘ì—…í™˜ê²½ êµ¬ì„±"
categories: [DeepLearning]
tags: Python
mathjax: true
---

* content
{:toc}
# 1. WSL 2 & Ubuntu
- ğŸ“Œ [ì´ì „ ë²„ì „ WSLì˜ ìˆ˜ë™ ì„¤ì¹˜ ë‹¨ê³„](https://docs.microsoft.com/ko-kr/windows/wsl/install-manual)

## 1.1 ê¸°ë³¸ í”„ë¡œê·¸ë¨ ì„¤ì¹˜
Microsoft Storeì—ì„œ [Windows Terminal](https://apps.microsoft.com/store/detail/windows-terminal/9N0DX20HK701?hl=ko-kr&gl=KR) ë° [Ubuntu 20.04.4 LTS](https://apps.microsoft.com/store/detail/ubuntu-20044-lts/9MTTCL66CPXJ?hl=ko-kr&gl=KR)ë¥¼ ì„¤ì¹˜í•œë‹¤.
**Windows Terminal** ì—†ì´ë„ í…ì„œí”Œë¡œìš° ì‘ì—…í™˜ê²½ì„ êµ¬ì„±í•˜ëŠ” ë°ëŠ” ë¬¸ì œ ì—†ì§€ë§Œ, ë§ì€ í¸ë¦¬í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ììœ ë¡­ê¸° ë•Œë¬¸ì— ì„¤ì¹˜í•œë‹¤.
**Ubuntu 20.04.4 LTS** ì„¤ì¹˜ê°€ ëë‚˜ë©´ ì‹¤í–‰í•œ ë‹¤ìŒ **username** ë° **password** ì„¤ì •ì„ ì§„í–‰í•œë‹¤.

## 1.2 WSL ì„¤ì¹˜
PowerShellì„ ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰í•œ ë‹¤ìŒ, **Linuxìš© Windows í•˜ìœ„ ì‹œìŠ¤í…œ ì‚¬ìš© ì˜µì…˜** ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •í•œë‹¤. 
```shell
> dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart 
```

## 1.3 WSL 2ë¡œ ì—…ë°ì´íŠ¸ ë° ê¸°ë³¸ ë²„ì „ìœ¼ë¡œ ì„¤ì •
ìœˆë„ìš° ë¹Œë“œê°€ 18362ë³´ë‹¤ ë‚®ìœ¼ë©´ WSL 2ë¥¼ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë²„ì „ì—…ì„ ì§„í–‰í•˜ê¸° ì „ì— ë¨¼ì € ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í™•ì¸í•´ì•¼ í•œë‹¤. 
ìœˆë„ìš° ë¹Œë“œëŠ” ì‹¤í–‰ ì°½(`Windows ë¡œê³  í‚¤ + R`)ì— **winver**ì„ ì…ë ¥í•˜ê±°ë‚˜, ì„¤ì •ì—ì„œ **PC ì •ë³´**ë¥¼ ê²€ìƒ‰í•´ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
ì—…ë°ì´íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤ë©´ PowerShellì„ ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰í•œ ë‹¤ìŒ, **Virtual Machine** ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •í•œë‹¤.
```shell
> dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
```
ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ WSL2ë¥¼ ê¸°ë³¸ ë²„ì „ìœ¼ë¡œ ì„¤ì •í•œë‹¤.
```shell
> wsl --set-default-version 2
```
ìœ„ ë°©ë²•ì´ ì‘ë™í•˜ì§€ ì•Šìœ¼ë©´ [ì´ê³³](aka.ms/wsl2kernel)ì—ì„œ ìµœì‹  WSL2 Linux ì»¤ë„ ì—…ë°ì´íŠ¸ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œ ë’¤, ë‹¤ìŒ ëª…ë ¹ì–´ì„ ëŒ€ì‹  ì…ë ¥í•œë‹¤.
```shell
> wsl --set-default-version Ubuntu-20.04 2
```
WSL ë²„ì „ì€ ë‹¤ìŒê³¼ ê°™ì´ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```shell
> wsl -l -v

  NAME                   STATE           VERSION
* Ubuntu-20.04           Running         2
```
VERSIONì´ 2ë¡œ í‘œì‹œë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

# 2. Docker & Tensorflow
- ğŸ“Œ [Tensorflow > Docker](https://www.tensorflow.org/install/docker?hl=ko)

## 2.1 Windowsì— Docker ë°ìŠ¤í¬í†± ì„¤ì¹˜
[ì´ê³³](https://docs.docker.com/desktop/windows/install/)ì—ì„œ Windowsìš© Docker ë°ìŠ¤í¬íƒ‘ì„ ì„¤ì¹˜í•œ ë‹¤ìŒ, WSL 2ì—ì„œ ë„ì»¤ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•œë‹¤.
General ë©”ë‰´ì˜ Use the WSL 2 based engine ì˜µì…˜ì— ì²´í¬í•œë‹¤.
![](https://github.com/B31l/B31l/blob/main/posts/DeepLearning/20220713_01.png?raw=true)
Resources -> WSL Integration ë©”ë‰´ì˜ ì˜µì…˜ì„ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•œë‹¤.
![](https://github.com/B31l/B31l/blob/main/posts/DeepLearning/20220713_02.png?raw=true)

## 2.2 Ubuntuì— Docker ì—”ì§„ ì„¤ì¹˜
- ğŸ“Œ [Ubuntuì— Docker ì—”ì§„ ì„¤ì¹˜](https://docs.docker.com/engine/install/ubuntu/)

ë¨¼ì € Ubuntuë¥¼ ì‹¤í–‰í•œë‹¤.
HTTPSë¥¼ í†µí•´ Reopsitoryë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ aptë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œë‹¤.
``` shell
$ sudo apt-get update
$ sudo apt-get install \
    ca-certificates \
    curl \
    gnupg \
    lsb-release
```
ì„œëª…ì„ ìœ„í•œ Dockerì˜ ê³µì‹ GPG í‚¤ë¥¼ ì¶”ê°€í•œë‹¤.
```shell
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
```
ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì„¤ì •í•œë‹¤.
```shell
$ echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```
aptë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  Docker ì—”ì§„ì„ ì„¤ì¹˜í•œë‹¤.
ë§Œì•½ íŠ¹ì • ë²„ì „ì„ ì„¤ì¹˜í•˜ê³  ì‹¶ë‹¤ë©´ [ì´ê³³](https://docs.docker.com/engine/install/ubuntu/#install-docker-engine)ì˜ ë‘ ë²ˆì§¸ ë‹¨ë½ì„ ì°¸ê³ í•œë‹¤.
``` shell
$ sudo apt-get update
$ sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin
```
hello-world ì´ë¯¸ì§€ë¥¼ ì‹¤í–‰í•´ Docker ì—”ì§„ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.
```shell
$ sudo docker run hello-world
```

## 2.3 ì„¤ì¹˜ í›„ ë‹¨ê³„ (Optional)
- ğŸ“Œ [ì„ íƒì  ì„¤ì¹˜ í›„ ë‹¨ê³„](https://docs.docker.com/engine/install/linux-postinstall/)

ë£¨íŠ¸ê°€ ì•„ë‹Œ ì‚¬ìš©ì ê·¸ë£¹ì— rootì™€ ë™ì¼í•œ ê¶Œí•œì„ ë¶€ì—¬í•˜ë©´ Dockerë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.
ë¨¼ì €, docker ê·¸ë£¹ì„ ìƒì„±í•œë‹¤.
```shell
$ sudo groupadd docker
```
ìƒì„±í•œ docker ê·¸ë£¹ì— ì‚¬ìš©ìë¥¼ ì¶”ê°€í•œ ë‹¤ìŒ, ì¬ì‹œì‘í•œë‹¤.
```shell
$ sudo usermod -aG docker $USER
$ newgrp docker 
```
`/var/run/docker.sock` íŒŒì¼ì˜ ê¶Œí•œì„ 666ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ê·¸ë£¹ ë‚´ ë‹¤ë¥¸ ì‚¬ìš©ìë„ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ ë³€ê²½í•œë‹¤.
```shell
$ sudo chmod 666 /var/run/docker.sock
```
ì´ì œ `sudo` ëª…ë ¹ì–´ ì—†ì´ë„ docker ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```shell
$ docker run hello-world
```

## 2.4 NVIDIA Docker ì§€ì› ì„¤ì¹˜
- ğŸ“Œ [NVIDIA Docker ì§€ì›ì„ ì„¤ì¹˜](https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#docker)

Linux í™˜ê²½ì—ì„œ Tensorflowê°€ GPUë¥¼ ì§€ì›í•˜ë ¤ë©´ NVIDIA Docker ì§€ì›ì„ ì„¤ì¹˜í•´ì•¼ í•œë‹¤.
NVIDIA íŒ¨í‚¤ì§€ ë¦¬í¬ì§€í† ë¦¬ ë° GPC í‚¤ë¥¼ ì„¤ì¹˜í•œë‹¤.
```shell
$ distribution=$(. /etc/os-release;echo $ID$VERSION_ID) \
      && curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \
      && curl -s -L https://nvidia.github.io/libnvidia-container/$distribution/libnvidia-container.list | \
            sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \
            sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list
```
aptë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  `nvidia-docker2` íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œ ë‹¤ìŒ, ë„ì»¤ ë°ëª¬ì„ ì¬ì‹œì‘í•´ ì„¤ì¹˜ë¥¼ ì™„ë£Œí•œë‹¤.
```shell
$ sudo apt-get update
$ sudo apt-get install -y nvidia-docker2
$ sudo systemctl restart docker
```
ì´ ì‹œì ì—ì„œ CUDA ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•´ ì‘ë™ ì„±ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤.
```shell
$ sudo docker run --rm --gpus all nvidia/cuda:11.0.3-base-ubuntu20.04 nvidia-smi

+-----------------------------------------------------------------------------+
| NVIDIA-SMI 510.51       Driver Version: 511.69       CUDA Version: 11.6     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|===============================+======================+======================|
|   0  NVIDIA GeForce ...  On   | 00000000:01:00.0 Off |                  N/A |
| N/A   48C    P8    N/A /  N/A |      0MiB /  4096MiB |      1%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+

+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|        ID   ID                                                   Usage      |
|=============================================================================|
|  No running processes found                                                 |
+-----------------------------------------------------------------------------+
```

## 2.5 Tensorflow Docker ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
- ğŸ“Œ [Tensorflow Docker ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ](https://www.tensorflow.org/install/docker?hl=ko#download_a_tensorflow_docker_image)

ê³µì‹ Tensorflow Docker ì´ë¯¸ì§€ëŠ” [tensorflow/tensorflow](https://hub.docker.com/r/tensorflow/tensorflow/) Docker hub ì €ì¥ì†Œì— ìˆìœ¼ë©°, ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ë¦¬ëˆ…ìŠ¤ì—ì„œ ì´ë¯¸ì§€ë¥¼ íƒœê·¸í•  ìˆ˜ ìˆë‹¤.
ë² ì´ìŠ¤ íƒœê·¸ë¥¼ ì‚¬ìš©í•´ Tensorflow ì´ë¯¸ì§€ì˜ ë²„ì „ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

| ë² ì´ìŠ¤ íƒœê·¸ | ì„¤ëª…                                               |
| ----------- | -------------------------------------------------- |
| `latest`    | TensorFlow CPU ë°”ì´ë„ˆë¦¬ ì´ë¯¸ì§€ì˜ ìµœì‹  ì¶œì‹œ(ê¸°ë³¸ê°’) |
| `version`   | TensorFlow ë°”ì´ë„ˆë¦¬ ì´ë¯¸ì§€ì˜Â ë²„ì „ ì§€ì •(ì˜ˆ:Â 2.1.0)  |

ê° ë² ì´ìŠ¤ íƒœê·¸ì—ëŠ” ê¸°ëŠ¥ ì¶”ê°€ë¥¼ ìœ„í•´ íƒœê·¸ ë³€ì´ë¥¼ ì ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ì—¬ëŸ¬ ë³€ì´ë¥¼ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤.
| íƒœê·¸ ë³€ì´     | ì„¤ëª…                  |
| ------------- | --------------------- |
| `tag-gpu`     | GPU ì§€ì›              |
| `tag-jupyter` | Jupyter Notebook í¬í•¨ |

GPUë¥¼ ì§€ì›í•˜ëŠ” Jupyter Notebook í™˜ê²½ì—ì„œ ìµœì‹  ë²„ì „ì˜ Tensorflowë¥¼ ì‚¬ìš©í•  ê²ƒì´ë¯€ë¡œ ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•œë‹¤.
``` shell
$ docker pull tensorflow/tensorflow:latest-gpu-jupyter
```

## 2.6 Jupyter Notebook ì‹¤í–‰
ë„ì»¤ë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” **Docker Daemon**ì´ ì‹¤í–‰ì¤‘ì´ì—¬ì•¼ í•˜ë¯€ë¡œ í™œì„±í™”í•œë‹¤.
```shell
$ sudo service docker start
```
ë‹¤ìŒ ëª…ë ¹ìœ¼ë¡œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ê³  ìƒì„±ëœ ë§í¬ë¡œ ì´ë™í•˜ë©´ ì£¼í”¼í„° ë…¸íŠ¸ë¶ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
```shell
docker run --gpus all -lt -v $(realpath ~/notebooks):/tf/notebooks -p 8888:8888 tensorflow/tensorflow:latest-gpu-jupyter
```
í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ notebooks í´ë”ë¡œ ì´ë™í•´ ìƒˆ ipynb íŒŒì¼ì„ ìƒì„±í•œë‹¤.
ë‹¤ìŒ ì½”ë“œëŠ” Tensorflowì˜ ë²„ì „ì„ í™•ì¸í•œë‹¤.
```python
import tensorflow as tf

print(tf.__version__)
```
ë‹¤ìŒ ì½”ë“œëŠ” Tensorflowê°€ GPUë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
```python
from tensorflow.python.client import device_lib

print(device_lib.list_local_devices())
```
ì£¼í”¼í„° ë…¸íŠ¸ë¶ì„ ì¢…ë£Œí•˜ë ¤ë©´ ìš°ì¸¡ ìƒë‹¨ì˜ `Quit` ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.