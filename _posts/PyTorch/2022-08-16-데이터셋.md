---
title: "λ°μ΄ν„°μ…‹"
categories: [PyTorch]
tags: Python
mathjax: true
---

* content
{:toc}
# λ°μ΄ν„°μ…‹(Dataset)

λ¨λΈ ν›λ ¨μ— μ‚¬μ©λλ” μƒν”κ³Ό λ μ΄λΈ”μ„ λ¬¶λ” μ»¨ν…μ΄λ„λ¥Ό λ°μ΄ν„°μ…‹(Dataset)μ΄λΌ ν•λ‹¤.

## torchvision

π§¶`torchvision.datasets` λ¨λ“μ€ μΈκ³µμ§€λ¥ ν•™μµμ„ μ„ν• λ‹¤μ–‘ν• λ°μ΄ν„°μ…‹μ„ μ κ³µν•λ‹¤.

μλ¥Ό λ“¤μ–΄, μ λ…ν• λ°μ΄ν„°μ…‹ μ¤‘ ν•λ‚μΈ **FashionMNIST** λ°μ΄ν„°μ…‹μ€ λ‹¤μκ³Ό κ°™μ΄ λ¶λ¬μ¬ μ μλ‹¤.

```python
from torchvision import datasets
from torchvision.transforms import ToTensor, Lambda

training_data = datasets.FashionMNIST(
    root="data",
    train=True,
    download=True,
    transform=ToTensor()
    target_transform=Lambda(lambda y: torch.zeros(10, dtype=torch.float).scatter_(0, torch.tensor(y), value=1))
)
```

FashionMNIST λ°μ΄ν„°μ…‹ ν΄λμ¤μ λ§¤κ°λ³€μλ” λ‹¤μκ³Ό κ°™λ‹¤. λ‹¤λ¥Έ λ°μ΄ν„°μ…‹μ λ§¤κ°λ³€μλ” [π“μ΄κ³³](https://pytorch.org/vision/stable/datasets.html)μ—μ„ ν™•μΈν•  μ μλ‹¤.

-   `root`(ν•„μ)

    λ°μ΄ν„°μ…‹ μ €μ¥ κ²½λ΅λ¥Ό μ§€μ •ν•λ‹¤.

-   `train`

    ν›λ ¨μ…‹μΌλ΅ μ‚¬μ©ν•  κ²½μ° Trueλ΅ μ§€μ •ν•λ‹¤. ν…μ¤νΈμ…‹μΌλ΅ μ‚¬μ©ν•  κ²½μ° Falseλ΅ μ§€μ •ν•λ‹¤.

-   `download`

    λ°μ΄ν„°μ…‹μ λ‹¤μ΄ μ—¬λ¶€λ¥Ό μ§€μ •ν•λ‹¤.

    Trueλ΅ μ§€μ •ν•  κ²½μ°, rootμ— λ°μ΄ν„°μ…‹μ΄ μ—†μ„ λ• μΈν„°λ„·μ—μ„ λ‹¤μ΄λ΅λ“ν•λ‹¤.

-   `transform`

    λ°μ΄ν„°μ…‹μ **νΉμ§•**(Feature)μ— μ μ©ν•  **λ³€ν•**μ„ μ§€μ •ν•λ‹¤.

    π§¶`torchvision.transforms` λ¨λ“μ€ μ—¬λ¬ λ³€ν• ν•¨μλ¥Ό μ κ³µν•λ‹¤.

    π§¶`torchvision.transforms.ToTensor()` ν•¨μλ” **PIL μ΄λ―Έμ§€**λ¥Ό `FloatTensor`λ΅ λ³€ν™ν•λ‹¤.

-   `target_transform`

    λ°μ΄ν„°μ…‹μ **λ μ΄λΈ”**(Label)μ— μ μ©ν•  λ³€ν•μ„ μ§€μ •ν•λ‹¤.

    π§¶`torchvision.transforms.Lambda()` ν•¨μλ” μ‚¬μ©μ μ •μ λλ‹¤ ν•¨μλ¥Ό μ μ©ν•λ‹¤.

    λ³€ν• μ „ yλ” 0λ¶€ν„° 9κΉμ§€μ κ°’ μ¤‘ ν•λ‚μ΄λ©°, λ‹¤μ λλ‹¤μ‹μ„ μ μ©ν•΄ yλ²μ§Έ μΈλ±μ¤μ κ°’μ΄ 1μ΄κ³  λ‹¤λ¥Έ μΈλ±μ¤μ κ°’μ΄ 0μΈ ν¬κΈ° 10μ 1μ°¨μ› ν…μ„λ΅ μ›-ν•« μΈμ½”λ”©ν•  μ μλ‹¤.

    ```python
    Lambda(lambda y: torch.zeros(10, dtype=torch.float).scatter_(0, torch.tensor(y), value=1))
    ```

## μ‚¬μ©μ μ •μ λ°μ΄ν„°μ…‹

π§¶`torch.utils.data.Dataset`λ¥Ό μƒμ†λ°›λ” ν΄λμ¤λ¥Ό μƒμ„±ν•΄ μ‚¬μ©μ μ •μ λ°μ΄ν„°μ…‹μ„ κµ¬μ„±ν•  μ μλ‹¤.

μ‚¬μ©μ μ •μ λ°μ΄ν„°μ…‹ ν΄λμ¤λ” λ°λ“μ‹ `__init_`, `__len__`, `__getitem__` λ©”μ„λ“λ¥Ό κµ¬ν„ν•΄μ•Ό ν•λ‹¤.

```python
from torch.utils.data import Dataset

class JointDataset(Dataset):
    def __init__(self, x, y):
        self.x = x
        self.y = y
    
    def __len__(self):
        return len(self.x)

    def __getitem__(self, idx):
        return self.x[idx], self.y[idx]
```

μ‚¬μ©μ μ •μ λ°μ΄ν„°μ…‹ κ°μ²΄λ¥Ό μƒμ„±ν•κ³ , μ‘λ™μ„ ν™•μΈν•λ‹¤.

```python
torch.manual_seed(1)

t_x = torch.rand([4, 3], dtype=torch.float32)
t_y = torch.arange(4)

joint_dataset = JointDataset(t_x, t_y)

print("length:", len(joint_dataset))
for example in joint_dataset:
    print(f"x: {example[0]}, y: {example[1]}")
```

<u>μ‹¤ν–‰ κ²°κ³Ό</u>

```
length: 4
x: tensor([0.7576, 0.2793, 0.4031]), y: 0
x: tensor([0.7347, 0.0293, 0.7999]), y: 1
x: tensor([0.3971, 0.7544, 0.5695]), y: 2
x: tensor([0.4388, 0.6387, 0.5247]), y: 3
```

## λ°μ΄ν„°λ΅λ”(DataLoader)

λ¨λΈ ν›λ ¨ μ‹ κ° **μ—ν¬ν¬**(Epoch)λ§λ‹¤ λ°μ΄ν„°μ…‹ μ „μ²΄λ¥Ό μνν•λ©°, κ° **μν**(Iteration)λ§λ‹¤ λ°°μΉ μ‚¬μ΄μ¦λ§νΌμ μƒν”κ³Ό λ μ΄λΈ”μ„ μ‚¬μ©ν•λ‹¤.

μ΄ κ³Όμ •μ—μ„ μνν•  λ°μ΄ν„°μ…‹μ λ°°μΉ μ‚¬μ΄μ¦λ¥Ό μ§μ ‘ μ§€μ •ν•κ±°λ‚, κ° μ—ν¬ν¬κ°€ λλ‚  λ•λ§λ‹¤ λ°μ΄ν„°μ…‹μ„ μ„λ” λ“±μ κΈ°λ¥μ΄ ν•„μ”ν•  μ μλ‹¤.

λ°μ΄ν„°λ΅λ”(DataLoader)λ¥Ό μ‚¬μ©ν•λ©΄ μ΄λ¬ν• λ³µμ΅ν• κ³Όμ •λ“¤μ„ μ¶”μƒν™”ν•  μ μλ‹¤.

π§¶`torch.utils.data.DataLoader` ν΄λμ¤μ λ§¤κ°λ³€μλ” λ‹¤μκ³Ό κ°™λ‹¤. μ „μ²΄ λ§¤κ°λ³€μλ” [π“μ΄κ³³](https://pytorch.org/docs/stable/data.html)μ—μ„ ν™•μΈν•  μ μλ‹¤.

-   `dataset`(ν•„μ)

-   `batch_size`=1

    **λ°°μΉ μ‚¬μ΄μ¦**λ¥Ό μ§€μ •ν•λ‹¤. λ§μ•½ ν¬κΈ° 10μ λ°μ΄ν„°μ…‹μ—μ„ batch_sizeλ¥Ό 1λ΅ μ§€μ •ν•λ©΄ μ΄ 10/1 = 10λ²μ μνκ°€ μ΄λ£¨μ–΄μ§„λ‹¤.

- `shuffle`=False

    κ³Όμ ν•© λ°©μ§€λ¥Ό μ„ν•΄ κ° μ—ν¬ν¬κ°€ λλ‚  λ•λ§λ‹¤ λ°μ΄ν„°μ…‹μ„ **μ„μ–΄μ„ μ‚¬μ©**ν• μ§€ κ²°μ •ν•λ‹¤.

- `drop_last`=False

    λ§μ§€λ§‰ λ°°μΉμ ν¬κΈ°κ°€ λ°°μΉ μ‚¬μ΄μ¦λ³΄λ‹¤ μ‘μ€(λ‚λ„μ–΄λ–¨μ–΄μ§€μ§€ μ•λ”) κ²½μ°, λ§μ§€λ§‰ λ°°μΉλ¥Ό dropν• μ§€ κ²°μ •ν•λ‹¤.

λ°μ΄ν„°λ΅λ”λ¥Ό μ‚¬μ©ν•΄ μ„μ—μ„ μƒμ„±ν• μ‚¬μ©μ μ •μ λ°μ΄ν„°μ…‹ κ°μ²΄λ¥Ό μνν•κ³ , μ‘λ™μ„ ν™•μΈν•λ‹¤.

```python
torch.manual_seed(1)

data_loader = DataLoader(dataset=joint_dataset, batch_size=2, shuffle=True)

for epoch in range(2):
    print(f"epoch {epoch+1}")
    for i, batch in enumerate(data_loader, 1):
        print(f"    batch {i}:\n        x: {batch[0]}\n        y: {batch[1]}")
```

<u>μ‹¤ν–‰ κ²°κ³Ό</u>

```
epoch 1
    batch 1:
        x: tensor([[0.3971, 0.7544, 0.5695],
        [0.7576, 0.2793, 0.4031]])
        y: tensor([2, 0])
    batch 2:
        x: tensor([[0.4388, 0.6387, 0.5247],
        [0.7347, 0.0293, 0.7999]])
        y: tensor([3, 1])
epoch 2
    batch 1:
        x: tensor([[0.3971, 0.7544, 0.5695],
        [0.7347, 0.0293, 0.7999]])
        y: tensor([2, 1])
    batch 2:
        x: tensor([[0.7576, 0.2793, 0.4031],
        [0.4388, 0.6387, 0.5247]])
        y: tensor([0, 3])
```

---

# π“REF

-   **Machine Learning with PyTorch and Scikit-Learn**
-   https://tutorials.pytorch.kr/beginner/basics/data_tutorial.html>
-   <https://tutorials.pytorch.kr/beginner/basics/transforms_tutorial.html>
