---
layout: post
title: "☕ Thread"
meta: "멀티스레드"
categories: Java
tags: Java
comments: true
mathjax: true
---



* content
{:toc}
# 멀티태스킹

멀티태스킹(multi tasking)은 여러 개의 작업이 동시에 처리되는 것을 의미한다.

## 멀티 프로세스(multi process)

**애플리케이션 단위**의 멀티 태스킹

하나의 응용 프로그램이 여러 개의 프로세스를 생성하고, 각 프로세스는 하나의 작업을 처리한다. **프로세스는 독립적이다**. 메모리 영역을 공유하지 않기 때문에 한 프로세스에서 오류가 발생해도 다른 프로세스에 영향을 미치지 않는다.  그러나 멀티 스레드에 비해 **문맥 교환에 의한 오버헤드 발생이 큰 편**이며, 이는 큰 시간 소모로 이어진다.

## 멀티 스레드(multi thread)

**애플리케이션 내부**의 멀티 태스킹

하나의 응용 프로그램이 여러 개의 스레드를 생성하고, 각 스레드는 하나의 작업을 처리한다.  **스레드는 독립적이지 않다**. 같은 프로세스 내의 다른 스레드와 자원을 공유하기 때문에 **문맥 교환에 따른 오버헤드 발생이 작은 편**이다. 그러나 한 스레드에서 오류가 발생한다면 자원을 공유하는 다른 스레드 역시 영향을 받는다. 대부분의 운영체제는 멀티 스레드를 기본으로 사용한다.

---

# 스레드 객체 생성

**Runnable 인터페이스를 구현**하거나, **Thread 클래스를 상속**받아 스레드 객체를 생성할 수 있다.

## 메인 스레드

사실, 우리는 메인 스레드라고 하는 스레드를 하나 가지고 시작한다. 캐릭터를 생성하면 지급하는 기본 장비같은 개념이다. 

이 메인 스레드에서 다른 스레드를 호출해서 멀티태스킹을 할 수 있다.

## Runnable 인터페이스 구현

1. **Runnable 인터페이스를 구현**하고 **run() 메서드를 재정의**한다.

   ```java
   class Foo implements Runnable {
       @Override
       public void run() {
           /* 스레드가 실행할 코드 */
       }
   }
   ```

1. **작업 스레드 객체를 생성**한다. 먼저 **Runnable 구현 객체**를 생성한 뒤, 이를 매개변수로 해서 **Thread 생성자를 호출**한다.

   ```java
   Runnable foo = new Foo();			// Runnable 구현 객체 생성
   ```

   ```java
   Thread th = new Thread(runnable);	// Thread 생성자 호출
   ```

**익명 구현 객체**를 사용하면 훨씬 간단하게 표현할 수 있다.

```java
Thread th = new Thread(new Runnable() {
    @Override
    public void run() {
        /* 스레드가 실행할 코드 */
    }
});
```

body가 하나이므로 **람다식**으로 표현도 가능하다.

```java
Thread th = new Thread(() -> {
    /* 스레드가 실행할 코드 */
});
```

## Thread 클래스 상속

1. **Thread 클래스를 상속**하고, **run() 메서드를 재정의**한다.

   ```java
   public class FooThread extends Thread {
       @Override
       public void run() {
           /* 스레드가 실행할 코드 */
       }
   }
   ```

1. **작업 스레드 객체를 생성**한다.

   ```java
   Thread th = new FooThread();
   ```

### 2. 익명 객체

```java
Thread th = new Thread() {
    public void run() {
        /* 스레드가 실행할 코드 */
    }
};
```

---

# 스레드 설정

스레드의 이름을 변경하거나 우선순위를 부여할 수 있다.

## 이름 설정하기

기본적으로 스레드는 고유의 이름을 갖고 있다. **getName() 메서드**로 이름을 확인하고, **setName() 메서드**로 이름을 변경할 수 있다. 

```java
thread.setName("스레드 이름");
```

```java
thread.getName();
```

## 우선순위 설정하기

스레드의 우선순위는 1부터 10까지의 정수로 표현되며, 숫자가 클수록 높은 우선순위를 갖는다. JVM은 높은 우선순위를 가진 스레드가 더 많은 실행 상태를 가지도록 스케쥴링한다. 만약 이 우선순위를 변경하고 싶으면 **setPriority() 메서드**를 사용하면 된다.

```java
thread.setPriority(우선순위);
```

우선순위에는 정수값을 넣어도 좋고, Thread 클래스에서 기본적으로 제공하는 상수를 이용할 수도 있다.

| 상수                   | 값   |
| ---------------------- | ---- |
| Thread.`MAX_PRIORITY`  | 10   |
| Thread.`NORM_PRIORITY` | 5    |
| Thread.`MIN_PRIORITY`  | 1    |

---

# 스레드 상태

<img src="C:\Users\rnfhr\OneDrive\바탕 화면\sssss.png" alt="sssss" style="zoom:75%;" /> 

**getState() 메서드**는 현재 스레드의 상태를 반환한다.

- NEW : 스레드 생성

  **스레드 객체를 최초로 생성 시** 이 상태로 시작한다.

- RUNNABLE : 스레드 실행 대기

  NEW 상태에서 **start() 메서드를 호출 시** 이 상태로 변경된다.

- WAITING : 스레드 일시 정지

  RUNNABLE에서 join() 메서드 등 **매개변수가 없는 일시 정지 메서드 호출 시** 이 상태로 변경된다.

- TIMED_WAITING : 스레드 일시 정지

   RUNNABLE에서 join(int) 메서드, sleep(int) 메서드 등 **매개변수가 정수형인 일시 정지 메서드 호출 시** 이 상태로 변경된다.

- BLOCKED : 스레드 일시 정지

  다른 스레드가 **임계 영억(critical section) 진입 시** 이 상태로 변경된다.

  > 임계 영역 : 동기화 메서드나 동기화 블록 등 단 하나의 스레드만 실행할 수 있는 영역을 의미한다. 후술

- TERMINATED : 스레드 종료

  **run() 메서드가 종료되거나 예외 발생 시** 이 상태로 변경된다. 실행 중인 스레드가 하나라도 있다면 프로세스는 종료되지 않는다.

  
